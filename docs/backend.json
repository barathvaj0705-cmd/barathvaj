{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile within the StudyBuddy AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time the user registered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "registrationDate"
      ]
    },
    "Quiz": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quiz",
      "type": "object",
      "description": "Represents a quiz generated by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Quiz entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Quiz)"
        },
        "title": {
          "type": "string",
          "description": "Title of the quiz."
        },
        "topic": {
          "type": "string",
          "description": "Topic of the quiz."
        },
        "difficulty": {
          "type": "string",
          "description": "Difficulty level of the quiz."
        },
        "creationDate": {
          "type": "string",
          "description": "Date and time the quiz was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProfileId",
        "title",
        "topic",
        "difficulty",
        "creationDate"
      ]
    },
    "QuizResult": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "QuizResult",
      "type": "object",
      "description": "Represents the result of a quiz taken by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the QuizResult entity."
        },
        "quizId": {
          "type": "string",
          "description": "Reference to Quiz. (Relationship: Quiz 1:N QuizResult)"
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N QuizResult)"
        },
        "score": {
          "type": "number",
          "description": "The score obtained in the quiz."
        },
        "completionDate": {
          "type": "string",
          "description": "Date and time the quiz was completed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "quizId",
        "userProfileId",
        "score",
        "completionDate"
      ]
    },
    "ChatbotInteraction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatbotInteraction",
      "type": "object",
      "description": "Represents an interaction between the user and the chatbot.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ChatbotInteraction entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N ChatbotInteraction)"
        },
        "question": {
          "type": "string",
          "description": "The question asked by the user."
        },
        "answer": {
          "type": "string",
          "description": "The answer provided by the chatbot."
        },
        "timestamp": {
          "type": "string",
          "description": "Date and time of the interaction.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProfileId",
        "question",
        "answer",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information.  The 'userId' path segment corresponds to the Firebase Auth UID.  This path ensures that only the authenticated user can access their own profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, corresponding to their Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/quizzes/{quizId}",
        "definition": {
          "entityName": "Quiz",
          "schema": {
            "$ref": "#/backend/entities/Quiz"
          },
          "description": "Stores quizzes created by the user. Path-based ownership ensures only the user can access their quizzes. The `userProfileId` field within the Quiz document must match the `userId` path parameter for data integrity. The 'userId' segment corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user who created the quiz."
            },
            {
              "name": "quizId",
              "description": "The unique ID of the quiz."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/quizResults/{quizResultId}",
        "definition": {
          "entityName": "QuizResult",
          "schema": {
            "$ref": "#/backend/entities/QuizResult"
          },
          "description": "Stores quiz results for each user. Path-based ownership ensures only the user can access their quiz results. The `userProfileId` field within the QuizResult document must match the `userId` path parameter for data integrity. The 'userId' segment corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user who took the quiz."
            },
            {
              "name": "quizResultId",
              "description": "The unique ID of the quiz result."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/chatbotInteractions/{chatbotInteractionId}",
        "definition": {
          "entityName": "ChatbotInteraction",
          "schema": {
            "$ref": "#/backend/entities/ChatbotInteraction"
          },
          "description": "Stores chatbot interaction history for each user. Path-based ownership ensures only the user can access their interaction history. The `userProfileId` field within the ChatbotInteraction document must match the `userId` path parameter for data integrity.  The 'userId' segment corresponds to the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user who interacted with the chatbot."
            },
            {
              "name": "chatbotInteractionId",
              "description": "The unique ID of the chatbot interaction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the StudyBuddy AI application's core features, including secure user management, AI chatbot interactions, customizable quizzes, and user history tracking. The structure emphasizes authorization independence and efficient data retrieval through denormalization and path-based ownership.  User profiles are stored under `/users/{userId}`, providing a clear and secure ownership model. Quizzes, QuizResults, and ChatbotInteractions are stored as subcollections of user profiles (`/users/{userId}/quizzes/{quizId}`, `/users/{userId}/quizResults/{quizResultId}`, and `/users/{userId}/chatbotInteractions/{chatbotInteractionId}`). This approach ensures that data is directly associated with the user and simplifies security rules based on user ownership.  Authorization Independence is achieved because all access to quiz data and chatbot interaction data happens under the user's document. Thus, every quiz and chatbot interaction is implicitly authorized based on the current user. List operations are secured by the path-based ownership model which ensures that users can only list quizzes, quiz results, and chatbot interactions associated with their user ID (QAPs)."
  }
}